{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Scatter plot of Maternal Mortality against GDP per capita. Interactive range slider allows us to filter by year. Interactive legend lets us highlight continents.",

  "data": {
    "url": "https://raw.githubusercontent.com/jhellingsdata/RADataHub/main/e4e/ch1_GDP/data/mortality_gdp.json"
  },

  "view": {"stroke": "transparent"},

  "title": {
    "text": "GDP and Maternal Mortality",
    "subtitle": [
      "Maternal mortality per million live births. Source: WHO",
      "GDP: per capita PPP (2021 $). Source: World Bank",
      ""
    ],
    "anchor": "start"
  },

  "width": 500,
  "height": 300,

  "params": [
    {
      "name": "yearSelector",
      "value": 2000,
      "bind": {
        "input": "range",
        "min": 2000,
        "max": 2017,
        "step": 1,
        "name": "Select year:"
      }
    },
    {
      "name": "leg_region",
      "select": {"type": "point", "fields": ["Region"]},
      "bind": "legend"
    },
    {
      "name": "Countryfilter",
      "value": "",
      "bind": {
        "input": "text",
        "placeholder": "Type country name (e.g., Albania)",
        "name": "Filter by country:"
      }
    }
  ],

  "transform": [
    {"filter": "datum.Year == yearSelector"},
    {"filter": "!Countryfilter || indexof(lower(datum.Country), lower(Countryfilter)) >= 0"}
  ],

  "mark": {"type": "circle"},
  "encoding": {
    "x": {
      "field": "GDP pc",
      "type": "quantitative",
      "scale": {"type": "log", "domain": [400, 150000]},
      "axis": {
        "title": "GDP (log scale)",
        "values": [400, 1000, 2000, 4000, 10000, 20000, 40000, 100000],
        "gridOpacity": 0.3,
        "labelFontSize": 12,
        "labelPadding": 5,
        "titlePadding": 6,
        "ticks": false,
        "format": "$,"
      }
    },
    "tooltip": [
      {"field": "Year"},
      {"field": "Country"},
      {"field": "Maternal Mortality", "format": ","},
      {"field": "GDP pc", "format": "$,d", "title": "GDP Per Capita"}
    ],
    "y": {
      "field": "Maternal Mortality",
      "type": "quantitative",
      "axis": {
        "title": "Mortality (log scale)",
        "values": [1, 2, 10, 20, 100, 200, 1000, 2000, 10000],
        "gridOpacity": 0.3,
        "labelFontSize": 13,
        "labelPadding": 5,
        "ticks": false,
        "titlePadding": -4
      },
      "scale": {"type": "log"}
    },
    "color": {
      "field": "Region",
      "type": "nominal",
      "legend": {
        "title": null,
        "direction": "horizontal",
        "orient": "top",
        "offset": 12,
        "labelFontSize": 12,
        "labelPadding": 10,
        "columns":3,
        "labelOffset": 2
      }
    },
    "size": {
      "field": "Population",
      "type": "quantitative",
      "legend": null,
      "scale": {"type": "linear", "range": [10, 1200]}
    },
    "opacity": {
      "condition": {"param": "leg_region", "value": 1},
      "value": 0.2
    },
    "order": {
      "condition": {"param": "leg_region", "value": 1},
      "value": 0
    }
  }
}